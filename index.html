<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Committee Quick Actions</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .buttons-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
    }
    button {
      padding: 10px 12px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    /* Highlight the selected button in green */
    .selected {
      background-color: #28a745 !important;
    }
    .log {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #ddd;
      width: 90%;
      max-width: 600px;
      min-height: 50px;
      background: #f9f9f9;
      font-size: 16px;
      text-align: left;
      overflow-y: auto;
      transition: background 0.3s;
    }
    .log.copied {
      background: #d4edda;
    }
    .copy-btn {
      margin-top: 10px;
      background-color: #dc3545;
    }
    .copy-btn:hover {
      background-color: #c82333;
    }
    .section {
      width: 90%;
      max-width: 600px;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ddd;
      background: #f1f1f1;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    .vote-tally-controls {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 10px 0;
    }
    .vote-tally-controls div {
      display: flex;
      align-items: center;
      gap: 6px;
    }
  </style>
</head>
<body>

  <h2>Committee Quick Actions</h2>

  <div class="container">
    <label for="committeeSelect"><b>Select Committee:</b></label>
    <select id="committeeSelect" onchange="updateMembers()">
      <option value="energy">Energy & Natural Resources</option>
      <option value="judiciary">Judiciary</option>
    </select>

    <h3>Select Member:</h3>
    <div class="buttons-container" id="members-container"></div>

    <div class="section">
      <h3>Main Actions</h3>
      <div class="buttons-container">
        <button onclick="setMainAction(this, 'Moved')">Moved</button>
        <button onclick="setMainAction(this, 'Roll Call Vote on SB')">Roll Call Vote on SB</button>
        <button onclick="setMainAction(this, 'Roll Call Vote on Amendment')">Roll Call Vote on Amendment</button>
      </div>
    </div>

    <!-- Sub Actions for "Moved" only -->
    <div class="section hidden" id="sub-actions">
      <h3>Sub Actions (Moved)</h3>
      <div class="buttons-container" id="sub-actions-container"></div>
    </div>

    <!-- Bill Type section for "Moved" sub-action -->
    <div class="section hidden" id="bill-type-section">
      <h3>Select Bill Type</h3>
      <div class="buttons-container" id="bill-type-container"></div>
    </div>

    <!-- Optional "as Amended" for Roll Call Vote on SB -->
    <div class="section hidden" id="as-amended-section">
      <h3>Optional: As Amended?</h3>
      <div class="buttons-container">
        <button id="asAmendedBtn" onclick="toggleAsAmended(this)">As Amended</button>
      </div>
    </div>

    <!-- Vote Tally: for Roll Call Votes (SB or Amendment) -->
    <div class="section hidden" id="vote-tally-section">
      <h3>Vote Tally (FOR - AGAINST - NEUTRAL)</h3>
      <div class="vote-tally-controls">
        <div>
          <strong>For:</strong>
          <button onclick="incrementVote('for', true)">+</button>
          <span id="forCount">0</span>
          <button onclick="incrementVote('for', false)">-</button>
        </div>
        <div>
          <strong>Against:</strong>
          <button onclick="incrementVote('against', true)">+</button>
          <span id="againstCount">0</span>
          <button onclick="incrementVote('against', false)">-</button>
        </div>
        <div>
          <strong>Neutral:</strong>
          <button onclick="incrementVote('neutral', true)">+</button>
          <span id="neutralCount">0</span>
          <button onclick="incrementVote('neutral', false)">-</button>
        </div>
      </div>
    </div>

    <!-- Bill Carrier Section: only for "Roll Call Vote on SB" -->
    <div class="section hidden" id="bill-carrier-section">
      <h3>Select Bill Carrier</h3>
      <div class="buttons-container" id="bill-carrier-container"></div>
    </div>

    <div class="section">
      <h3>Meeting Actions</h3>
      <div class="buttons-container">
        <button onclick="appendMeetingAction('Closed Hearing')">Closed Hearing</button>
        <button onclick="appendMeetingAction('Recessed Meeting')">Recessed Meeting</button>
        <button onclick="appendMeetingAction('Adjourned Meeting')">Adjourned Meeting</button>
        <button onclick="appendMeetingAction('Reconvened Meeting')">Reconvened Meeting</button>
        <!-- Special: "Seconded" has no dash in the final statement -->
        <button onclick="appendMeetingAction('Seconded')">Seconded</button>
      </div>
    </div>

    <!-- Copy button + Auto Copy checkbox -->
    <div style="margin-top:10px;">
      <button class="copy-btn" onclick="copyToClipboard()">ðŸ“‹ Copy to Clipboard (Ctrl + Enter)</button>
      <label style="margin-left: 10px;">
        <input type="checkbox" id="autoCopyCheckbox" onchange="onAutoCopyChanged()" />
        Auto Copy
      </label>
    </div>

    <h3>Constructed Statement:</h3>
    <div class="log" id="log">[Click a member and an action]</div>
  </div>

  <script>
    let selectedMember = "";
    let mainAction = "";
    let selectedSubAction = "";   // For "Moved" => "Do Pass" or "Do Not Pass"
    let selectedBillType = "";    // For "Moved" => "SB", "HB", or "Amendment"
    let selectedCarrier = "";     // Only for "Roll Call Vote on SB"
    let constructedStatement = "";
    let currentCommittee = "";

    // For roll call vote on SB: "as Amended"?
    let asAmended = false;

    // Auto Copy?
    let autoCopyEnabled = false;

    // Vote tally
    let forVal = 0;
    let againstVal = 0;
    let neutralVal = 0;

    const committees = {
      energy: [
        "Chairman Dale Patton",
        "Vice Chairman Greg Kessel",
        "Senator Todd Beard",
        "Senator Keith Boehm",
        "Senator Mark Enget",
        "Senator Justin Gerhardt",
        "Senator Desiree Van Oosting"
      ],
      judiciary: [
        "Chairwoman Diane Larson",
        "Vice Chairman Bob Paulson",
        "Senator Jose Castaneda",
        "Senator Claire Cory",
        "Senator Larry Luick",
        "Senator Janne Myrdal",
        "Senator Ryan Braunberger"
      ]
    };

    // Called when user checks/unchecks "Auto Copy"
    function onAutoCopyChanged() {
      autoCopyEnabled = document.getElementById("autoCopyCheckbox").checked;
      // If turning ON and we already have a statement, copy immediately
      if (autoCopyEnabled && constructedStatement.trim() !== "[Click a member and an action]" && constructedStatement.trim() !== "") {
        copyToClipboard();
      }
    }

    // If auto-copy is on, copy the current statement automatically
    function autoCopyIfEnabled() {
      if (autoCopyEnabled) {
        copyToClipboard(false); // We'll pass a param to skip the highlight flicker if you prefer
      }
    }

    function updateMembers() {
      currentCommittee = document.getElementById("committeeSelect").value;
      resetSelections();

      const membersContainer = document.getElementById("members-container");
      membersContainer.innerHTML = "";
      committees[currentCommittee].forEach(member => {
        const btn = document.createElement("button");
        btn.innerText = member;
        btn.onclick = () => selectMember(member, btn);
        membersContainer.appendChild(btn);
      });
    }

    function selectMember(member, btn) {
      resetSelections();
      selectedMember = member;
      updateStatement();

      // Highlight the selected member
      document.querySelectorAll("#members-container button").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }

    function setMainAction(button, action) {
      if (!selectedMember) {
        alert("Please select a member first!");
        return;
      }
      mainAction = action;
      selectedSubAction = "";
      selectedBillType = "";
      selectedCarrier = "";
      asAmended = false; // reset to false each time we switch main actions

      updateStatement();

      // Highlight the selected main action
      document.querySelectorAll(".section:nth-of-type(2) button").forEach(b => b.classList.remove("selected"));
      button.classList.add("selected");

      // Show/hide sections
      if (action === "Moved") {
        showMovedSubActions();
        showVoteTallySection(false);
        showBillCarrierSection(false);
        showAsAmendedSection(false);
      }
      else if (action === "Roll Call Vote on SB") {
        document.getElementById("sub-actions").classList.add("hidden");
        document.getElementById("bill-type-section").classList.add("hidden");
        showVoteTallySection(true);
        showBillCarrierSection(true);
        showAsAmendedSection(true); // show the "As Amended" button
      }
      else if (action === "Roll Call Vote on Amendment") {
        document.getElementById("sub-actions").classList.add("hidden");
        document.getElementById("bill-type-section").classList.add("hidden");
        showVoteTallySection(true);
        showBillCarrierSection(false);
        showAsAmendedSection(false); // not applicable for amendment
      }
    }

    function showMovedSubActions() {
      const subActionsContainer = document.getElementById("sub-actions-container");
      subActionsContainer.innerHTML = "";
      document.getElementById("sub-actions").classList.remove("hidden");

      const subActions = ["Do Pass", "Do Not Pass"];
      subActions.forEach(subAction => {
        const btn = document.createElement("button");
        btn.innerText = subAction;
        btn.onclick = () => handleMovedSubAction(btn, subAction);
        subActionsContainer.appendChild(btn);
      });
    }

    function handleMovedSubAction(button, subAction) {
      selectedSubAction = subAction;
      updateStatement();

      // Highlight chosen sub action
      document.querySelectorAll("#sub-actions-container button").forEach(b => b.classList.remove("selected"));
      button.classList.add("selected");

      // Show Bill Type: "SB", "HB", "Amendment"
      showBillTypeSection(true);
    }

    // Bill Type => "SB", "HB", "Amendment"
    function showBillTypeSection(visible) {
      const billTypeSection = document.getElementById("bill-type-section");
      if (visible) {
        billTypeSection.classList.remove("hidden");
        const billTypeContainer = document.getElementById("bill-type-container");
        billTypeContainer.innerHTML = "";

        const types = ["SB", "HB", "Amendment"];
        types.forEach(t => {
          const btn = document.createElement("button");
          btn.innerText = t;
          btn.onclick = () => selectBillType(t, btn);
          billTypeContainer.appendChild(btn);
        });
      } else {
        billTypeSection.classList.add("hidden");
      }
    }

    function selectBillType(type, btn) {
      selectedBillType = type;
      updateStatement();

      // Highlight the chosen bill type
      document.querySelectorAll("#bill-type-container button").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }

    // "As Amended" button for Roll Call Vote on SB
    function showAsAmendedSection(visible) {
      const asAmendedSec = document.getElementById("as-amended-section");
      if (visible) {
        asAmendedSec.classList.remove("hidden");
      } else {
        asAmendedSec.classList.add("hidden");
      }
    }

    function toggleAsAmended(btn) {
      asAmended = !asAmended;
      // Toggle highlight if you'd like
      if (asAmended) {
        btn.classList.add("selected");
      } else {
        btn.classList.remove("selected");
      }
      updateStatement();
    }

    // Show/hide vote tally
    function showVoteTallySection(visible) {
      const tallySec = document.getElementById("vote-tally-section");
      if (visible) {
        tallySec.classList.remove("hidden");
        resetVoteTally();
      } else {
        tallySec.classList.add("hidden");
      }
    }

    // Show/hide bill carrier (only for "Roll Call Vote on SB")
    function showBillCarrierSection(visible) {
      const carrierSection = document.getElementById("bill-carrier-section");
      if (visible) {
        carrierSection.classList.remove("hidden");
        const carrierContainer = document.getElementById("bill-carrier-container");
        carrierContainer.innerHTML = "";

        committees[currentCommittee].forEach(member => {
          const btn = document.createElement("button");
          btn.innerText = member;
          btn.onclick = () => selectBillCarrier(member, btn);
          carrierContainer.appendChild(btn);
        });
      } else {
        carrierSection.classList.add("hidden");
      }
    }

    function selectBillCarrier(member, btn) {
      selectedCarrier = member;
      document.querySelectorAll("#bill-carrier-container button").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      updateStatement();
    }

    // Vote tally increment/decrement
    function incrementVote(type, isIncrement) {
      if (type === 'for') {
        if (isIncrement) forVal++;
        else if (forVal > 0) forVal--;
      } else if (type === 'against') {
        if (isIncrement) againstVal++;
        else if (againstVal > 0) againstVal--;
      } else if (type === 'neutral') {
        if (isIncrement) neutralVal++;
        else if (neutralVal > 0) neutralVal--;
      }
      document.getElementById('forCount').innerText = forVal;
      document.getElementById('againstCount').innerText = againstVal;
      document.getElementById('neutralCount').innerText = neutralVal;

      updateStatement();
    }

    // Pass/fail logic (ties are fail)
    function getMotionResultText() {
      if (forVal > againstVal) {
        return "Motion Passed";
      } else {
        return "Motion Failed";
      }
    }

    // Rebuild the constructedStatement from the current state
    function updateStatement() {
      if (!selectedMember) {
        document.getElementById("log").innerText = "[Click a member and an action]";
        return;
      }

      let parts = [];

      // 1) "Roll Call Vote on SB" or "Roll Call Vote on Amendment"
      if (mainAction === "Roll Call Vote on SB" || mainAction === "Roll Call Vote on Amendment") {
        // We do NOT prepend the selectedMember
        // e.g. "Roll Call Vote on SB as Amended - Motion Passed - 7-0-0 - Senator X Carried the Bill"
        // or "Roll Call Vote on Amendment - Motion Passed - 7-0-0"
        let actionText = mainAction; // "Roll Call Vote on SB"
        if (mainAction === "Roll Call Vote on SB" && asAmended) {
          actionText = "Roll Call Vote on SB as Amended";
        }

        parts.push(actionText);
        parts.push(getMotionResultText());
        parts.push(`${forVal}-${againstVal}-${neutralVal}`);

        // Only add carrier if "Roll Call Vote on SB" and selectedCarrier is set
        if (actionText.includes("SB") && selectedCarrier) {
          parts.push(`${selectedCarrier} Carried the Bill`);
        }
      }

      // 2) "Moved"
      else if (mainAction === "Moved") {
        // e.g. "Chairman Dale Patton - Moved Do Pass on SB"
        parts.push(selectedMember);
        if (selectedSubAction && selectedBillType) {
          parts.push(`Moved ${selectedSubAction} on ${selectedBillType}`);
        } else if (selectedSubAction) {
          parts.push(`Moved ${selectedSubAction}`);
        } else {
          // If subAction not chosen yet
          parts.push("Moved");
        }
      }

      // 3) If it's some other action, e.g. none of the above
      else if (mainAction) {
        // e.g. "Chairman Dale Patton - SomeOtherAction"
        parts.push(`${selectedMember} - ${mainAction}`);
      }

      // If we ended up with no parts, show default
      if (parts.length === 0) {
        constructedStatement = "[Click a member and an action]";
      } else {
        constructedStatement = parts.join(" - ");
      }

      document.getElementById("log").innerText = constructedStatement;
      autoCopyIfEnabled(); // auto-copy if checked
    }

    function resetVoteTally() {
      forVal = 0;
      againstVal = 0;
      neutralVal = 0;
      document.getElementById('forCount').innerText = 0;
      document.getElementById('againstCount').innerText = 0;
      document.getElementById('neutralCount').innerText = 0;
    }

    // Meeting actions
    // "Seconded" => "Chairman Dale Patton Seconded"
    // Otherwise => "Chairman Dale Patton - Closed Hearing", etc.
    function appendMeetingAction(action) {
      if (!selectedMember) {
        alert("Please select a member first!");
        return;
      }
      if (action === "Seconded") {
        constructedStatement = `${selectedMember} Seconded`;
      } else {
        constructedStatement = `${selectedMember} - ${action}`;
      }
      document.getElementById("log").innerText = constructedStatement;
      autoCopyIfEnabled();
    }

    // Copy to clipboard
    // pass highlight=true if we want the green highlight effect
    function copyToClipboard(highlight = true) {
      if (!constructedStatement || constructedStatement.startsWith("[Click a member")) {
        return;
      }
      navigator.clipboard.writeText(constructedStatement);
      if (highlight) {
        const log = document.getElementById("log");
        log.classList.add("copied");
        setTimeout(() => log.classList.remove("copied"), 1000);
      }
    }

    // Resets everything except the committee selection
    function resetSelections() {
      selectedMember = "";
      mainAction = "";
      selectedSubAction = "";
      selectedBillType = "";
      selectedCarrier = "";
      asAmended = false;
      constructedStatement = "";

      resetVoteTally();

      // Hide relevant sections
      document.getElementById("sub-actions").classList.add("hidden");
      document.getElementById("bill-type-section").classList.add("hidden");
      document.getElementById("vote-tally-section").classList.add("hidden");
      document.getElementById("bill-carrier-section").classList.add("hidden");
      document.getElementById("as-amended-section").classList.add("hidden");

      // Remove .selected from all buttons
      document.querySelectorAll("button").forEach(b => b.classList.remove("selected"));

      // Reset log text
      document.getElementById("log").innerText = "[Click a member and an action]";
    }

    // Support Ctrl + Enter to copy
    document.addEventListener("keydown", function(event) {
      if (event.ctrlKey && event.key === "Enter") {
        copyToClipboard();
      }
    });

    // Initialize the first committee on page load
    updateMembers();
  </script>
</body>
</html>
