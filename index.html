<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Committee Quick Actions</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .buttons-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
    }
    button {
      padding: 10px 12px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    /* Highlight the selected button in green */
    .selected {
      background-color: #28a745 !important;
    }
    .log {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #ddd;
      width: 90%;
      max-width: 600px;
      min-height: 50px;
      background: #f9f9f9;
      font-size: 16px;
      text-align: left;
      overflow-y: auto;
      transition: background 0.3s;
    }
    .log.copied {
      background: #d4edda;
    }
    .copy-btn {
      margin-top: 10px;
      background-color: #dc3545;
    }
    .copy-btn:hover {
      background-color: #c82333;
    }
    .section {
      width: 90%;
      max-width: 600px;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ddd;
      background: #f1f1f1;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    .vote-tally-controls {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 10px 0;
    }
    .vote-tally-controls div {
      display: flex;
      align-items: center;
      gap: 6px;
    }
  </style>
</head>
<body>

  <h2>Committee Quick Actions</h2>

  <div class="container">
    <label for="committeeSelect"><b>Select Committee:</b></label>
    <select id="committeeSelect" onchange="updateMembers()">
      <option value="energy">Energy & Natural Resources</option>
      <option value="judiciary">Judiciary</option>
    </select>

    <h3>Select Member:</h3>
    <div class="buttons-container" id="members-container"></div>

    <div class="section">
      <h3>Main Actions</h3>
      <div class="buttons-container">
        <button onclick="setMainAction(this, 'Moved')">Moved</button>
        <button onclick="setMainAction(this, 'Roll Call Vote on SB')">Roll Call Vote on SB</button>
        <button onclick="setMainAction(this, 'Roll Call Vote on Amendment LC#')">Roll Call Vote on Amendment LC#</button>
      </div>
    </div>

    <!-- Sub Actions for "Moved" only -->
    <div class="section hidden" id="sub-actions">
      <h3>Sub Actions (Moved)</h3>
      <div class="buttons-container" id="sub-actions-container"></div>
    </div>

    <!-- Bill Type section for "Moved" sub-action -->
    <div class="section hidden" id="bill-type-section">
      <h3>Select Bill Type</h3>
      <div class="buttons-container" id="bill-type-container"></div>
    </div>

    <!-- Vote Tally: for all Roll Call Votes (with pass/fail logic) -->
    <div class="section hidden" id="vote-tally-section">
      <h3>Vote Tally (FOR - AGAINST - NEUTRAL)</h3>
      <div class="vote-tally-controls">
        <div>
          <strong>For:</strong>
          <button onclick="incrementVote('for', true)">+</button>
          <span id="forCount">0</span>
          <button onclick="incrementVote('for', false)">-</button>
        </div>
        <div>
          <strong>Against:</strong>
          <button onclick="incrementVote('against', true)">+</button>
          <span id="againstCount">0</span>
          <button onclick="incrementVote('against', false)">-</button>
        </div>
        <div>
          <strong>Neutral:</strong>
          <button onclick="incrementVote('neutral', true)">+</button>
          <span id="neutralCount">0</span>
          <button onclick="incrementVote('neutral', false)">-</button>
        </div>
      </div>
    </div>

    <!-- Bill Carrier Section: only for "Roll Call Vote on SB" -->
    <div class="section hidden" id="bill-carrier-section">
      <h3>Select Bill Carrier</h3>
      <div class="buttons-container" id="bill-carrier-container"></div>
    </div>

    <div class="section">
      <h3>Meeting Actions</h3>
      <div class="buttons-container">
        <button onclick="appendMeetingAction('Closed Hearing')">Closed Hearing</button>
        <button onclick="appendMeetingAction('Recessed Meeting')">Recessed Meeting</button>
        <button onclick="appendMeetingAction('Adjourned Meeting')">Adjourned Meeting</button>
        <button onclick="appendMeetingAction('Reconvened Meeting')">Reconvened Meeting</button>
      </div>
    </div>

    <button class="copy-btn" onclick="copyToClipboard()">ðŸ“‹ Copy to Clipboard (Ctrl + Enter)</button>

    <h3>Constructed Statement:</h3>
    <div class="log" id="log">[Click a member and an action]</div>
  </div>

  <script>
    let selectedMember = "";
    let mainAction = "";
    let selectedSubAction = "";   // For "Moved" => "Do Pass" or "Do Not Pass"
    let selectedBillType = "";    // For "Moved" => "SB", "HB", or "Amendment"
    let selectedCarrier = "";     // Only for "Roll Call Vote on SB"
    let constructedStatement = "";
    let currentCommittee = "";

    // Vote tally variables (for any Roll Call Vote)
    let forVal = 0;
    let againstVal = 0;
    let neutralVal = 0;

    const committees = {
      energy: [
        "Chairman Dale Patton",
        "Vice Chairman Greg Kessel",
        "Senator Todd Beard",
        "Senator Keith Boehm",
        "Senator Mark Enget",
        "Senator Justin Gerhardt",
        "Senator Desiree Van Oosting"
      ],
      judiciary: [
        "Chairwoman Diane Larson",
        "Vice Chairman Bob Paulson",
        "Senator Jose Castaneda",
        "Senator Claire Cory",
        "Senator Larry Luick",
        "Senator Janne Myrdal",
        "Senator Ryan Braunberger"
      ]
    };

    // Initialize on page load
    function updateMembers() {
      currentCommittee = document.getElementById("committeeSelect").value;
      resetSelections();

      const membersContainer = document.getElementById("members-container");
      membersContainer.innerHTML = "";
      committees[currentCommittee].forEach(member => {
        const btn = document.createElement("button");
        btn.innerText = member;
        btn.onclick = () => selectMember(member, btn);
        membersContainer.appendChild(btn);
      });
    }

    function selectMember(member, btn) {
      resetSelections();
      selectedMember = member;
      updateStatement();

      // Highlight the selected member
      document.querySelectorAll("#members-container button").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }

    function setMainAction(button, action) {
      if (!selectedMember) {
        alert("Please select a member first!");
        return;
      }
      mainAction = action;
      selectedSubAction = "";
      selectedBillType = "";
      selectedCarrier = "";
      updateStatement();

      // Highlight the selected main action
      document.querySelectorAll(".section:nth-of-type(2) button").forEach(b => b.classList.remove("selected"));
      button.classList.add("selected");

      // Decide what to show based on the main action
      if (action === "Moved") {
        // Show sub-actions: "Do Pass" / "Do Not Pass"
        showMovedSubActions();
        // Hide vote tally & carrier
        showVoteTallySection(false);
        showBillCarrierSection(false);
      } else if (action.includes("Roll Call Vote on SB")) {
        // Hide "Moved" sub-actions
        document.getElementById("sub-actions").classList.add("hidden");
        document.getElementById("bill-type-section").classList.add("hidden");

        // Show vote tally and show bill carrier
        showVoteTallySection(true);
        showBillCarrierSection(true);
      } else if (action.includes("Roll Call Vote on Amendment LC#")) {
        // Hide "Moved" sub-actions
        document.getElementById("sub-actions").classList.add("hidden");
        document.getElementById("bill-type-section").classList.add("hidden");

        // Show vote tally but NO carrier (amendment = no carrier)
        showVoteTallySection(true);
        showBillCarrierSection(false);
      }
    }

    /* "Moved" => sub-actions => "Do Pass" / "Do Not Pass" */
    function showMovedSubActions() {
      const subActionsContainer = document.getElementById("sub-actions-container");
      subActionsContainer.innerHTML = "";
      document.getElementById("sub-actions").classList.remove("hidden");

      const subActions = ["Do Pass", "Do Not Pass"];
      subActions.forEach(subAction => {
        const btn = document.createElement("button");
        btn.innerText = subAction;
        btn.onclick = () => handleMovedSubAction(btn, subAction);
        subActionsContainer.appendChild(btn);
      });
    }

    function handleMovedSubAction(button, subAction) {
      selectedSubAction = subAction;
      updateStatement();

      // Highlight chosen sub action
      document.querySelectorAll("#sub-actions-container button").forEach(b => b.classList.remove("selected"));
      button.classList.add("selected");

      // Show Bill Type: "SB", "HB", "Amendment"
      showBillTypeSection(true);
    }

    // Bill Type => "SB", "HB", or "Amendment"
    function showBillTypeSection(visible) {
      const billTypeSection = document.getElementById("bill-type-section");
      if (visible) {
        billTypeSection.classList.remove("hidden");
        const billTypeContainer = document.getElementById("bill-type-container");
        billTypeContainer.innerHTML = "";

        const types = ["SB", "HB", "Amendment"];
        types.forEach(t => {
          const btn = document.createElement("button");
          btn.innerText = t;
          btn.onclick = () => selectBillType(t, btn);
          billTypeContainer.appendChild(btn);
        });
      } else {
        billTypeSection.classList.add("hidden");
      }
    }

    function selectBillType(type, btn) {
      selectedBillType = type;
      updateStatement();

      // Highlight chosen bill type
      document.querySelectorAll("#bill-type-container button").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    }

    // Show/hide vote tally (for any roll call vote)
    function showVoteTallySection(visible) {
      const tallySec = document.getElementById("vote-tally-section");
      if (visible) {
        tallySec.classList.remove("hidden");
        resetVoteTally();
      } else {
        tallySec.classList.add("hidden");
      }
    }

    // Show/hide bill carrier (only for "Roll Call Vote on SB")
    function showBillCarrierSection(visible) {
      const carrierSection = document.getElementById("bill-carrier-section");
      if (visible) {
        carrierSection.classList.remove("hidden");
        const carrierContainer = document.getElementById("bill-carrier-container");
        carrierContainer.innerHTML = "";

        committees[currentCommittee].forEach(member => {
          const btn = document.createElement("button");
          btn.innerText = member;
          btn.onclick = () => selectBillCarrier(member, btn);
          carrierContainer.appendChild(btn);
        });
      } else {
        carrierSection.classList.add("hidden");
      }
    }

    function selectBillCarrier(member, btn) {
      selectedCarrier = member;
      document.querySelectorAll("#bill-carrier-container button").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      updateStatement();
    }

    // Vote tally increment/decrement
    function incrementVote(type, isIncrement) {
      if (type === 'for') {
        if (isIncrement) forVal++;
        else if (forVal > 0) forVal--;
      } else if (type === 'against') {
        if (isIncrement) againstVal++;
        else if (againstVal > 0) againstVal--;
      } else if (type === 'neutral') {
        if (isIncrement) neutralVal++;
        else if (neutralVal > 0) neutralVal--;
      }
      document.getElementById('forCount').innerText = forVal;
      document.getElementById('againstCount').innerText = againstVal;
      document.getElementById('neutralCount').innerText = neutralVal;

      updateStatement();
    }

    // Pass/fail logic (ties are fail)
    function getMotionResultText() {
      if (forVal > againstVal) {
        return "Motion Passed";
      } else {
        return "Motion Failed";
      }
    }

    // Rebuild the constructedStatement from the current state
    function updateStatement() {
      if (!selectedMember) {
        document.getElementById("log").innerText = "[Click a member and an action]";
        return;
      }

      let parts = [];
      // Always start with the selected member
      parts.push(selectedMember);

      // Then the main action
      if (mainAction) {
        parts.push(mainAction);
      }

      // Moved => "Moved Do Pass on SB", etc.
      if (mainAction === "Moved") {
        if (selectedSubAction && selectedBillType) {
          // e.g. "Moved Do Pass on SB"
          parts[1] = `Moved ${selectedSubAction} on ${selectedBillType}`;
        } else if (selectedSubAction) {
          // e.g. "Moved Do Pass"
          parts[1] = `Moved ${selectedSubAction}`;
        }
      }

      // Roll Call Votes => "Member - Roll Call Vote on X - Motion Passed - 4-3-0" ...
      if (mainAction.includes("Roll Call Vote")) {
        // Insert motion result, then tally
        const motionResult = getMotionResultText(); 
        parts.push(motionResult);
        parts.push(`${forVal}-${againstVal}-${neutralVal}`);

        // Only add carrier if it's "Roll Call Vote on SB"
        if (mainAction.includes("on SB") && selectedCarrier) {
          parts.push(`${selectedCarrier} Carried the Bill`);
        }
      }

      constructedStatement = parts.join(" - ");
      document.getElementById("log").innerText = constructedStatement;
    }

    function resetVoteTally() {
      forVal = 0;
      againstVal = 0;
      neutralVal = 0;
      document.getElementById('forCount').innerText = 0;
      document.getElementById('againstCount').innerText = 0;
      document.getElementById('neutralCount').innerText = 0;
    }

    function appendMeetingAction(action) {
      if (!selectedMember) {
        alert("Please select a member first!");
        return;
      }
      constructedStatement = `${selectedMember} - ${action}`;
      document.getElementById("log").innerText = constructedStatement;
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(constructedStatement);
      const log = document.getElementById("log");
      log.classList.add("copied");
      setTimeout(() => log.classList.remove("copied"), 1000);
    }

    // Resets everything except the committee selection
    function resetSelections() {
      selectedMember = "";
      mainAction = "";
      selectedSubAction = "";
      selectedBillType = "";
      selectedCarrier = "";
      constructedStatement = "";
      resetVoteTally();

      // Hide relevant sections
      document.getElementById("sub-actions").classList.add("hidden");
      document.getElementById("bill-type-section").classList.add("hidden");
      document.getElementById("vote-tally-section").classList.add("hidden");
      document.getElementById("bill-carrier-section").classList.add("hidden");

      // Remove .selected from all buttons
      document.querySelectorAll("button").forEach(b => b.classList.remove("selected"));

      // Reset log text
      document.getElementById("log").innerText = "[Click a member and an action]";
    }

    // Support Ctrl + Enter to copy
    document.addEventListener("keydown", function(event) {
      if (event.ctrlKey && event.key === "Enter") {
        copyToClipboard();
      }
    });

    // Initialize the first committee on page load
    updateMembers();
  </script>
</body>
</html>
